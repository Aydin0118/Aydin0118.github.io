<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aydin music player</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f7f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .player-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }
        .title {
            color: #4a7c59;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .current-song {
            background-color: #f8faf9;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 18px;
            color: #333;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .control-btn {
            background-color: #68a080;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        .control-btn:hover {
            background-color: #4a7c59;
        }
        .song-list {
            text-align: left;
            background-color: #f8faf9;
            border-radius: 10px;
            padding: 15px;
        }
        .song-list h3 {
            color: #4a7c59;
            margin-top: 0;
        }
        .song-item {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .song-item:last-child {
            border-bottom: none;
        }
        .active-song {
            color: #4a7c59;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <h1 class="title">Aydin music player</h1>
        <div class="current-song" id="currentSong">正在加载音乐列表...</div>
        <div class="controls">
            <button class="control-btn" id="prevBtn">⏮️</button>
            <button class="control-btn" id="playPauseBtn">▶️</button>
            <button class="control-btn" id="nextBtn">⏭️</button>
        </div>
        <div class="song-list">
            <h3>播放列表</h3>
            <div id="songList">正在加载...</div>
        </div>
    </div>

    <audio id="audioPlayer" preload="auto">

    <script>
        const musicFolder = "music/";
        const audioExtensions = ['mp3', 'wav', 'ogg', 'm4a', 'flac'];
        
        let playlist = [];
        let currentTrackIndex = 0;
        const audioPlayer = document.getElementById('audioPlayer');
        const currentSongEl = document.getElementById('currentSong');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const songListEl = document.getElementById('songList');

        async function loadMusicFromFolder() {
            try {
                const response = await fetch(musicFolder);
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const links = doc.querySelectorAll('a');
                
                playlist = [];
                
                links.forEach(link => {
                    const fileName = link.getAttribute('href');
                    if (fileName && audioExtensions.some(ext => fileName.toLowerCase().endsWith(ext))) {
                        const songName = fileName.replace(/\.[^/.]+$/, "");
                        playlist.push({
                            name: decodeURIComponent(songName),
                            src: musicFolder + fileName
                        });
                    }
                });
                
                if (playlist.length === 0) {
                    currentSongEl.textContent = "未找到音乐文件";
                    songListEl.innerHTML = "<div class='song-item'>请在music文件夹中添加音乐文件</div>";
                    return;
                }
                
                renderPlaylist();
                loadTrack();
                
            } catch (error) {
                console.error("加载音乐列表失败:", error);
                currentSongEl.textContent = "加载音乐列表失败";
                songListEl.innerHTML = "<div class='song-item'>请确保music文件夹存在且包含音乐文件</div>";
            }
        }

        function renderPlaylist() {
            songListEl.innerHTML = '';
            playlist.forEach((song, index) => {
                const item = document.createElement('div');
                item.className = `song-item ${index === currentTrackIndex ? 'active-song' : ''}`;
                item.textContent = song.name;
                item.onclick = () => {
                    currentTrackIndex = index;
                    loadTrack();
                    audioPlayer.play();
                    updateBtn();
                };
                songListEl.appendChild(item);
            });
        }

        function loadTrack() {
            if (playlist.length === 0) return;
            
            audioPlayer.src = playlist[currentTrackIndex].src;
            currentSongEl.textContent = `正在播放：${playlist[currentTrackIndex].name}`;
            renderPlaylist();
        }

        function updateBtn() {
            playPauseBtn.textContent = audioPlayer.paused ? '▶️' : '⏸️';
        }

        playPauseBtn.onclick = () => {
            if (playlist.length === 0) return;
            
            audioPlayer.paused ? audioPlayer.play() : audioPlayer.pause();
            updateBtn();
        };

        prevBtn.onclick = () => {
            if (playlist.length === 0) return;
            
            currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
            loadTrack();
            audioPlayer.play();
            updateBtn();
        };

        nextBtn.onclick = () => {
            if (playlist.length === 0) return;
            
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
            loadTrack();
            audioPlayer.play();
            updateBtn();
        };

        audioPlayer.onended = () => {
            if (playlist.length === 0) return;
            
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
            loadTrack();
            audioPlayer.play();
            updateBtn();
        };

        window.addEventListener('load', loadMusicFromFolder);
    </script>
</body>
</html>
