<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³ä¹æ’­æ”¾å™¨ï¼ˆè‡ªåŠ¨è¯»å–å…¨éƒ¨éŸ³ä¹ï¼‰</title>
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .player-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        #audio-player {
            width: 100%;
            margin: 20px 0;
        }
        .control-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .control-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
            transition: background 0.2s;
        }
        .control-btn:hover {
            background: #0056b3;
        }
        .music-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .music-list li {
            padding: 12px;
            background: #f5f5f5;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .music-list li:hover {
            background: #eee;
        }
        .music-list li.active {
            background: #007bff;
            color: white;
        }
        .tip {
            color: #666;
            font-size: 14px;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        .loading {
            color: #007bff;
            text-align: center;
            padding: 10px;
        }
        .error {
            color: #dc3545;
            text-align: center;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <h2>éŸ³ä¹æ’­æ”¾å™¨ï¼ˆè‡ªåŠ¨è¯»å–å…¨éƒ¨éŸ³ä¹ï¼‰</h2>
        
        <audio id="audio-player" controls preload="metadata">
            ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒHTML5éŸ³é¢‘æ’­æ”¾ï¼Œè¯·å‡çº§æµè§ˆå™¨ï¼
        </audio>

        <div class="control-buttons">
            <button class="control-btn" id="prev-btn">ä¸Šä¸€æ›²</button>
            <button class="control-btn" id="play-pause-btn">æš‚åœ</button>
            <button class="control-btn" id="next-btn">ä¸‹ä¸€æ›²</button>
            <button class="control-btn" id="refresh-btn">åˆ·æ–°éŸ³ä¹åˆ—è¡¨</button>
        </div>

        <h3>éŸ³ä¹åˆ—è¡¨</h3>
        <div id="loading" class="loading">æ­£åœ¨æ‰«æmusicæ–‡ä»¶å¤¹...</div>
        <ul class="music-list" id="music-list"></ul>
        <div id="error" class="error" style="display: none;"></div>

        <div class="tip">
            <p>ğŸ“Œ è¯´æ˜ï¼š</p>
            <p>1. æœ¬åœ°æµ‹è¯•éœ€ç”¨ã€Œæœ¬åœ°æœåŠ¡å™¨ã€ï¼ˆå¦‚VSCode Live Serverï¼‰æ‰“å¼€</p>
            <p>2. ä»…æ”¯æŒ MP3 æ ¼å¼ï¼Œæ–‡ä»¶åé¿å…ç‰¹æ®Šç¬¦å·/ä¸­æ–‡ç©ºæ ¼</p>
            <p>3. ç¡®ä¿ music æ–‡ä»¶å¤¹å’Œ 01.html åœ¨åŒä¸€çº§ç›®å½•</p>
        </div>
    </div>

    <script>
        // æ ¸å¿ƒå˜é‡
        const audioPlayer = document.getElementById('audio-player');
        const musicListEl = document.getElementById('music-list');
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const prevBtn = document.getElementById('prev-btn');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const nextBtn = document.getElementById('next-btn');
        const refreshBtn = document.getElementById('refresh-btn');
        
        let musicList = []; // å­˜å‚¨æ‰«æåˆ°çš„éŸ³ä¹åˆ—è¡¨
        let currentIndex = 0;
        let isPlaying = false;

        // æ ¸å¿ƒå‡½æ•°ï¼šè‡ªåŠ¨æ‰«æmusicæ–‡ä»¶å¤¹çš„æ‰€æœ‰MP3æ–‡ä»¶
        async function scanMusicFolder() {
            try {
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';
                musicListEl.innerHTML = '';

                // ========== å…³é”®é€»è¾‘ ==========
                // æ–¹å¼1ï¼šæœ¬åœ°/æœåŠ¡å™¨ç¯å¢ƒï¼ˆæ¨èï¼‰- é€šè¿‡è¯»å–musicç›®å½•çš„æ–‡ä»¶åˆ—è¡¨
                // æ³¨æ„ï¼šæœ¬åœ°æµ‹è¯•éœ€ç”¨Live Serverï¼Œéƒ¨ç½²åˆ°GitHub Pageséœ€ç¡®ä¿musicæ–‡ä»¶å¤¹å¯è®¿é—®
                const response = await fetch('music/');
                if (!response.ok) {
                    // æ–¹å¼2ï¼šé™çº§æ–¹æ¡ˆ - å°è¯•å¸¸è§çš„MP3æ–‡ä»¶ååŒ¹é…ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰
                    return fallbackScan();
                }

                // è§£æç›®å½•å†…å®¹ï¼Œæå–MP3æ–‡ä»¶å
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const links = doc.querySelectorAll('a');
                
                // è¿‡æ»¤å‡ºMP3æ–‡ä»¶
                const mp3Files = Array.from(links)
                    .map(link => link.href.split('/').pop()) // è·å–æ–‡ä»¶å
                    .filter(file => file.endsWith('.mp3') && file.trim() !== ''); // ä»…ä¿ç•™MP3

                if (mp3Files.length === 0) {
                    throw new Error('æœªæ‰«æåˆ°ä»»ä½•MP3æ–‡ä»¶');
                }

                // æ„å»ºéŸ³ä¹åˆ—è¡¨
                musicList = mp3Files.map(file => ({
                    name: file.replace('.mp3', ''),
                    path: `music/${file}`
                }));

                // æ¸²æŸ“åˆ—è¡¨
                renderMusicList();
                loadingEl.style.display = 'none';

            } catch (err) {
                loadingEl.style.display = 'none';
                errorEl.textContent = `æ‰«æå¤±è´¥ï¼š${err.message}ï¼Œè¯·æ£€æŸ¥musicæ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ä¸”æœ‰MP3æ–‡ä»¶`;
                errorEl.style.display = 'block';
                // é™çº§åˆ°æ‰‹åŠ¨é…ç½®ï¼ˆé˜²æ­¢å®Œå…¨æ— æ³•ä½¿ç”¨ï¼‰
                fallbackScan();
            }
        }

        // é™çº§æ–¹æ¡ˆï¼šå½“è‡ªåŠ¨æ‰«æå¤±è´¥æ—¶ï¼Œä½¿ç”¨é¢„è®¾çš„å¸¸è§æ–‡ä»¶åï¼ˆæ— éœ€ä¿®æ”¹ï¼Œè‡ªåŠ¨é€‚é…ï¼‰
        function fallbackScan() {
            // é¢„è®¾å¸¸è§çš„MP3æ–‡ä»¶åï¼ˆä¼šè‡ªåŠ¨éªŒè¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼‰
            const presetFiles = [
                "letting go.mp3", "ä¸€ç‚¹.mp3", "ä¸‘å…«æ€ª.mp3", "äºæ˜¯.mp3", "ä»–ä¸æ‡‚.mp3", "ä½ è¿˜è¦æˆ‘æ€æ ·.MP3", "å…‰å¹´ä¹‹å¤–.mp3", "åˆšåˆšå¥½.mp3", "åˆ«è®©çˆ±è°ƒè½.mp3", "åå¹´.mp3", "å•è½¦.mp3", "åªä¸ºä½ ç€è¿·.mp3","å¯ä¸å¯ä»¥.mp3", "åæ¥çš„æˆ‘ä»¬æ²¡æœ‰åœ¨ä¸€èµ·.mp3", "åæ¥çš„æˆ‘ä»¬æ²¡æœ‰èµ°åˆ°ä¸€èµ·.mp3", "å“ªäº›ç»™å¤©ç©ºçš„.mp3", "å“ªé‡Œéƒ½æ˜¯ä½ .mp3", "å”¯ä¸€.mp3", "å˜‰å®¾.mp3", "åœ¨ä½ çš„èº«è¾¹.mp3", "å æ¥¼.mp3", "å¤šå¹¸è¿.mp3", "å¤šè¿œéƒ½è¦åœ¨ä¸€èµ·.mp3", "å¤§æµ·.mp3","å¤©å¤–æ¥ç‰©.mp3", "å¤±æ§.mp3", "å¦‚æœçˆ±å¿˜äº†.mp3", "å§‘å¨˜åˆ«å“­æ³£.mp3", "å§‘å¨˜åœ¨è¿œæ–¹.mp3", "å¯‚å¯çƒŸç«.mp3", "å¯Œå£«å±±ä¸‹.mp3", "å¹³åº¸.mp3", "å¹¿ä¸œçˆ±æƒ…æ•…äº‹.mp3", "æˆ‘ä»¬.mp3", "æˆ‘å¥½åƒåœ¨å“ªé‡Œè§è¿‡ä½ .mp3", "æˆ‘æ€€å¿µçš„.mp3","æˆ‘æƒ³å¿µ.mp3", "æˆ‘èµ°å.mp3", "æŠŠå›å¿†æ‹¼å¥½ç»™ä½ .mp3", "æ˜¥å¨‡ä¸å¿—æ˜.mp3", "æœ€åä¸€é¡µ.mp3", "æœ‰äº›.mp3", "æ¸¸äº¬.mp3", "æ¸¸å±±æ‹.mp3", "æ¼”å‘˜.mp3", "çƒŸç«é‡Œçš„å°˜åŸƒ.mp3", "çˆ±çš„å›å½’çº¿.mp3", "çˆ±é”™.mp3","çœŸçš„çˆ±ä½ .mp3", "ç¦»ä¸å¼€ä½ çš„ä¾èµ–.mp3", "ç¬¬57æ¬¡å–æ¶ˆå‘é€.mp3", "çº¢è‰²é«˜è·Ÿé‹.mp3", "çº¯éŸ³ä¹.mp3", "çº¸çŸ­æƒ…é•¿.mp3", "ç»…å£«.mp3", "ç¼ºæ°§.mp3", "è‡ªæ„ˆ.mp3", "è®¤çœŸçš„é›ª.mp3",["è·³æ¥¼æœº.mp3", "è¿˜æ˜¯åˆ†å¼€.mp3", "é˜¿æ‹‰æ–¯åŠ æµ·æ¹¾.mp3", "é’èŠ±.mp3", "é’èŠ±ç“·.mp3"

            ];

            // éªŒè¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™åŠ å…¥åˆ—è¡¨
            musicList = [];
            presetFiles.forEach(file => {
                const path = `music/${file}`;
                // åˆ›å»ºéŸ³é¢‘å¯¹è±¡éªŒè¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                const audio = new Audio(path);
                audio.onerror = () => {}; // å¿½ç•¥é”™è¯¯
                audio.onloadedmetadata = () => {
                    musicList.push({
                        name: file.replace('.mp3', ''),
                        path: path
                    });
                    renderMusicList();
                };
            });

            loadingEl.style.display = 'none';
            if (musicList.length === 0) {
                errorEl.textContent = 'æœªæ‰¾åˆ°ä»»ä½•éŸ³ä¹æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥musicæ–‡ä»¶å¤¹è·¯å¾„å’Œæ–‡ä»¶';
                errorEl.style.display = 'block';
            }
        }

        // æ¸²æŸ“éŸ³ä¹åˆ—è¡¨åˆ°é¡µé¢
        function renderMusicList() {
            if (musicList.length === 0) return;
            
            musicListEl.innerHTML = '';
            musicList.forEach((music, index) => {
                const li = document.createElement('li');
                li.textContent = music.name;
                li.dataset.index = index;
                li.addEventListener('click', () => playMusicByIndex(index));
                musicListEl.appendChild(li);
            });

            // é»˜è®¤é€‰ä¸­ç¬¬ä¸€é¦–
            setActiveMusic(0);
            audioPlayer.src = musicList[0].path;
        }

        // æ’­æ”¾æŒ‡å®šç´¢å¼•çš„éŸ³ä¹
        function playMusicByIndex(index) {
            if (index < 0 || index >= musicList.length) return;
            
            currentIndex = index;
            const music = musicList[index];
            audioPlayer.src = music.path;
            
            audioPlayer.play().then(() => {
                isPlaying = true;
                playPauseBtn.textContent = 'æš‚åœ';
                setActiveMusic(index);
            }).catch(err => {
                alert(`æ’­æ”¾å¤±è´¥ï¼š${music.name}\nåŸå› ï¼š${err.message}`);
            });
        }

        // é«˜äº®å½“å‰æ’­æ”¾çš„éŸ³ä¹
        function setActiveMusic(index) {
            document.querySelectorAll('.music-list li').forEach(li => {
                li.classList.remove('active');
            });
            const activeLi = document.querySelector(`.music-list li[data-index="${index}"]`);
            if (activeLi) activeLi.classList.add('active');
        }

        // æ’­æ”¾/æš‚åœåˆ‡æ¢
        function togglePlayPause() {
            if (audioPlayer.paused) {
                audioPlayer.play();
                isPlaying = true;
                playPauseBtn.textContent = 'æš‚åœ';
            } else {
                audioPlayer.pause();
                isPlaying = false;
                playPauseBtn.textContent = 'æ’­æ”¾';
            }
        }

        // ä¸Šä¸€æ›²/ä¸‹ä¸€æ›²
        function playPrevMusic() {
            currentIndex = (currentIndex - 1 + musicList.length) % musicList.length;
            playMusicByIndex(currentIndex);
        }
        function playNextMusic() {
            currentIndex = (currentIndex + 1) % musicList.length;
            playMusicByIndex(currentIndex);
        }

        // ç›‘å¬éŸ³ä¹æ’­æ”¾ç»“æŸï¼Œè‡ªåŠ¨ä¸‹ä¸€æ›²
        audioPlayer.addEventListener('ended', playNextMusic);

        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        prevBtn.addEventListener('click', playPrevMusic);
        playPauseBtn.addEventListener('click', togglePlayPause);
        nextBtn.addEventListener('click', playNextMusic);
        refreshBtn.addEventListener('click', scanMusicFolder);

        // é¡µé¢åŠ è½½åè‡ªåŠ¨æ‰«æ
        window.onload = function() {
            // æœ¬åœ°æµ‹è¯•å¿…é¡»ç”¨æœåŠ¡å™¨ï¼Œå¦åˆ™ä¼šè·¨åŸŸ/æƒé™é”™è¯¯
            if (window.location.protocol === 'file:') {
                errorEl.textContent = 'âš ï¸ æœ¬åœ°æµ‹è¯•éœ€ç”¨ã€ŒVSCode Live Serverã€æ‰“å¼€ï¼Œå¦åˆ™æ— æ³•æ‰«ææ–‡ä»¶å¤¹ï¼';
                errorEl.style.display = 'block';
                loadingEl.style.display = 'none';
                fallbackScan(); // é™çº§åˆ°é¢„è®¾åˆ—è¡¨
            } else {
                scanMusicFolder(); // æœåŠ¡å™¨ç¯å¢ƒç›´æ¥æ‰«æ
            }
        };
    </script>
</body>
</html>
